name: ike-scan
version: "1.1.0"
description: "IKE/IPsec VPN enumeration for aggressive mode testing, transform discovery, PSK hash capture and cracking"
image: "ghcr.io/silicon-works/mcp-tools-ike-scan:latest"
image_size_mb: 150

capabilities:
  - ike_enumeration
  - vpn_testing
  - aggressive_mode
  - psk_capture
  - psk_cracking
  - transform_enumeration
  - group_name_bruteforce

routing:
  use_for:
    - "IKE enumeration"
    - "IPsec VPN testing"
    - "aggressive mode attack"
    - "VPN group name brute force"
    - "PSK hash capture"
    - "PSK hash cracking"
    - "port 500 UDP service"
  never_use_for:
    - "SSL VPN testing"
    - "OpenVPN testing"
  triggers:
    - "ike"
    - "ipsec"
    - "vpn port 500"
    - "psk crack"
  prefer_over: []

phases:
  - reconnaissance
  - enumeration
  - exploitation

requirements:
  network: true
  privileged: false

resources:
  memory_mb: 128
  cpu: 0.25

methods:
  scan:
    description: "Basic IKE scan to detect VPN endpoints"
    when_to_use: "To check if port 500 has an IKE service"
    params:
      target:
        type: string
        required: true
        description: "Target IP address or hostname"
      sport:
        type: integer
        default: 500
        description: "Source port"
      dport:
        type: integer
        default: 500
        description: "Destination port"
    returns:
      detected:
        type: boolean
        description: "Whether IKE service was detected"
      hosts:
        type: array
        description: "Responding hosts"
      vendor_id:
        type: string
        description: "Vendor ID if detected"

  aggressive_mode:
    description: "Test IKE aggressive mode with group name enumeration"
    when_to_use: "To test if VPN accepts a specific group name and capture PSK hash"
    params:
      target:
        type: string
        required: true
        description: "Target IP"
      group_name:
        type: string
        required: true
        description: "IKE group name (VPN ID) to test"
      dport:
        type: integer
        default: 500
        description: "Destination port"
    returns:
      valid_group:
        type: boolean
        description: "Whether group name is valid"
      psk_vulnerable:
        type: boolean
        description: "Whether PSK can be captured"
      transforms:
        type: array
        description: "Supported transforms"

  enumerate_transforms:
    description: "Enumerate supported IKE transforms/proposals"
    when_to_use: "To discover encryption and authentication methods supported"
    params:
      target:
        type: string
        required: true
        description: "Target IP"
      dport:
        type: integer
        default: 500
        description: "Destination port"
    returns:
      transforms:
        type: array
        description: "Supported transforms"
      vendor_id:
        type: string
        description: "Vendor identification"

  brute_group_names:
    description: "Brute force IKE group names with parallel scanning support"
    when_to_use: "To discover valid VPN group names for further exploitation"
    params:
      target:
        type: string
        required: true
        description: "Target IP"
      wordlist:
        type: string
        default: "common"
        description: "Wordlist: 'common', 'company', 'extensive', or file path"
      names:
        type: array
        description: "Inline list of group names to test (overrides wordlist)"
      dport:
        type: integer
        default: 500
        description: "Destination port"
      concurrency:
        type: integer
        default: 5
        description: "Number of parallel requests (max 10)"
      delay:
        type: number
        default: 0.1
        description: "Delay between requests in seconds"
      stop_on_first:
        type: boolean
        default: false
        description: "Stop when first valid group found"
    returns:
      valid_groups:
        type: array
        description: "Valid group names found"
      found_count:
        type: integer
        description: "Number of valid groups"
      tested_count:
        type: integer
        description: "Number of names tested"
      concurrency_used:
        type: integer
        description: "Concurrency level used"

  get_psk_hash:
    description: "Capture PSK hash for offline cracking"
    when_to_use: "After finding valid group name via brute_group_names or aggressive_mode"
    next_step: "Use ike-scan.crack_psk with the captured hash_data. Do NOT use john - it doesn't support IKE PSK format."
    params:
      target:
        type: string
        required: true
        description: "Target IP"
      group_name:
        type: string
        required: true
        description: "Valid IKE group name"
      dport:
        type: integer
        default: 500
        description: "Destination port"
    returns:
      psk_hash:
        type: string
        description: "PSK hash for cracking - pass this to crack_psk method"
      crackable:
        type: boolean
        description: "Whether hash was captured"

  crack_psk:
    description: "Crack a captured PSK hash using psk-crack (dictionary or brute force)"
    when_to_use: "After capturing PSK hash with get_psk_hash. This is the ONLY way to crack IKE PSK hashes - john does not support this format."
    params:
      hash_data:
        type: string
        required: true
        description: "PSK hash data from get_psk_hash"
      wordlist:
        type: string
        default: "common"
        description: "Built-in wordlist: 'common', 'rockyou_sample', or file path"
      passwords:
        type: array
        description: "Inline list of passwords to try (overrides wordlist)"
      bruteforce:
        type: boolean
        default: false
        description: "Use brute force instead of dictionary"
      charset:
        type: string
        default: "alnum"
        description: "Charset for brute force: 'alnum', 'alpha', 'numeric', 'special'"
      min_length:
        type: integer
        default: 1
        description: "Min password length for brute force"
      max_length:
        type: integer
        default: 6
        description: "Max password length for brute force"
    returns:
      cracked:
        type: boolean
        description: "Whether password was cracked"
      password:
        type: string
        description: "Cracked password if successful"
      method:
        type: string
        description: "Method used (dictionary or bruteforce)"
