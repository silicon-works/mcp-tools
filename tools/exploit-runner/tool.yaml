name: exploit-runner
version: "1.1"
description: "General-purpose exploit execution environment for running CVE exploits, PoCs, custom scripts, and parameterized exploit templates. Supports Python3, Python2, Ruby, and Bash scripts with automatic temp file management and output capture. Includes comprehensive binary exploitation toolkit: pwntools (Python exploit framework), GDB+pwndbg (debugger with exploit helpers), ropper (ROP gadget finder), one_gadget (libc one-shot RCE finder), patchelf (ELF binary patching), and impacket (Windows protocol exploitation). Also includes requests, paramiko, beautifulsoup4, pycryptodome, and build-essential for compiling C exploits. Provides YAML-based exploit templates with parameter substitution and success/failure indicator matching (3 built-in: Log4Shell, Cacti RCE, Jenkins file read). Payload generation for reverse/bind shells in bash/python/php."
image: "ghcr.io/silicon-works/mcp-tools-exploit-runner:latest"
image_size_mb: 800

capabilities:
  - python_exploits
  - shell_exploits
  - ruby_exploits
  - exploit_analysis
  - exploit_templates
  - payload_generation

routing:
  use_for:
    - "run known CVE exploits"
    - "execute exploit templates"
    - "generate reverse shell payloads"
    - "run PoC scripts"
    - "binary exploitation with pwntools"
    - "buffer overflow exploit development"
    - "ROP chain building"
    - "format string exploitation"
    - "ELF binary analysis checksec"
    - "pwntools scripting"
    - "GDB debugging binary"
    - "find buffer overflow offset"
  never_use_for:
    - "port scanning"
    - "enumeration"
  triggers:
    - "run exploit"
    - "execute PoC"
    - "CVE exploit"
    - "exploit template"
    - "run script"
  prefer_over: []

phases:
  - exploitation
  - post-exploitation

requirements:
  network: true
  privileged: true

resources:
  memory_mb: 512
  cpu: 1.0

methods:
  run_python:
    description: "Execute a Python exploit script with full output capture. Writes script content to temp file in /tmp/exploits/, runs with specified Python version, captures stdout/stderr (capped at 50KB/10KB), and cleans up temp files. The container has pwntools, requests, paramiko, impacket, pycryptodome, beautifulsoup4, lxml, ropper pre-installed — no pip install needed for these. Scripts can also be passed as base64 (for binary content or special characters) or by file path (for prepared exploits)."
    when_to_use: "The primary method for running exploits. Use for: (1) Running CVE exploit scripts from searchsploit (after get_exploit retrieves the code), (2) Running GitHub PoC scripts, (3) Writing and executing custom pwntools scripts for buffer overflows, format strings, ROP chains, (4) Running impacket-based Windows exploitation scripts (secretsdump, psexec, etc.), (5) Any Python exploit that needs network access to the target. The workflow: searchsploit search → searchsploit get_exploit → analyze_exploit (safety check) → prepare_exploit (if dependencies needed) → run_python."
    params:
      script:
        type: string
        required: true
        description: "Python script content or file path (if is_path=true)"
      args:
        type: array
        description: "Command line arguments for the script"
      is_path:
        type: boolean
        default: false
        description: "Whether script is a file path (vs inline content)"
      is_base64:
        type: boolean
        default: false
        description: "Whether script content is base64 encoded"
      python_version:
        type: enum
        values: [python3, python2]
        default: "python3"
        description: "Python version to use"
      timeout:
        type: integer
        default: 120
        description: "Execution timeout in seconds"
      env:
        type: object
        description: "Environment variables to set"
    returns:
      returncode:
        type: integer
        description: "Exit code"
      stdout:
        type: string
        description: "Standard output"
      stderr:
        type: string
        description: "Standard error"

  run_shell:
    description: "Execute a shell script or command in bash/sh/zsh. Writes script to temp file, makes it executable, runs with specified shell, and captures output. The container includes curl, wget, netcat (nc), nmap, git, gcc (build-essential), gdb, ltrace, strace, patchelf, and binutils — useful for compiling C exploits, network operations, and binary analysis."
    when_to_use: "For shell-based exploits, one-liners, or when you need to compile and run C exploits. Common uses: (1) Compile a C exploit from searchsploit: 'gcc exploit.c -o exploit && ./exploit', (2) Run bash-based reverse shell exploits, (3) Execute multi-step exploitation chains (download→compile→execute), (4) Run network utilities (nc, curl, wget) for exploit delivery. Use run_python instead for complex exploits that benefit from Python libraries."
    params:
      script:
        type: string
        required: true
        description: "Shell script content"
      args:
        type: array
        description: "Command line arguments"
      shell:
        type: enum
        values: [bash, sh, zsh]
        default: "bash"
        description: "Shell to use"
      timeout:
        type: integer
        default: 120
        description: "Execution timeout"
      env:
        type: object
        description: "Environment variables"
    returns:
      returncode:
        type: integer
        description: "Exit code"
      stdout:
        type: string
        description: "Standard output"
      stderr:
        type: string
        description: "Standard error"

  run_ruby:
    description: "Execute a Ruby exploit script"
    when_to_use: "To run Ruby-based exploits (many Metasploit modules)"
    params:
      script:
        type: string
        required: true
        description: "Ruby script content or path"
      args:
        type: array
        description: "Command line arguments"
      is_path:
        type: boolean
        default: false
        description: "Whether script is a file path"
      timeout:
        type: integer
        default: 120
        description: "Execution timeout"
      env:
        type: object
        description: "Environment variables to set"
    returns:
      returncode:
        type: integer
        description: "Exit code"
      stdout:
        type: string
        description: "Standard output"
      stderr:
        type: string
        description: "Standard error"

  prepare_exploit:
    description: "Save an exploit script to /tmp/exploits/ and optionally install Python dependencies via pip. Makes the file executable (chmod 755). Validates filename against path traversal. Content can be plain text or base64-encoded. Use this before run_python with is_path=true for exploits that need modification between runs or require additional pip packages."
    when_to_use: "When an exploit needs dependencies not pre-installed in the container, or when you want to save a script for repeated execution with different arguments. The workflow: (1) Get exploit code from searchsploit or GitHub, (2) analyze_exploit to check requirements, (3) prepare_exploit with requirements=['missing-package'], (4) run_python with is_path=true pointing to the saved path. Also useful for saving modified exploit code that you've customized for the target."
    params:
      content:
        type: string
        required: true
        description: "Exploit script content"
      filename:
        type: string
        required: true
        description: "Filename to save as"
      is_base64:
        type: boolean
        default: false
        description: "Whether content is base64 encoded"
      requirements:
        type: array
        description: "Python packages to install"
    returns:
      path:
        type: string
        description: "Saved exploit path"
      requirements_installed:
        type: array
        description: "Installed packages"

  list_exploits:
    description: "List prepared exploits in workspace"
    when_to_use: "To see available prepared exploits"
    params: {}
    returns:
      exploits:
        type: array
        description: "List of prepared exploits"

  analyze_exploit:
    description: "Static analysis of an exploit script — detects language (Python/Ruby/Shell), counts lines, extracts imports, identifies dangerous patterns (eval, exec, subprocess, os.system, rm -rf), network operations (socket, requests, curl, nc), file operations, and estimates pip requirements from imports. Does NOT execute the script."
    when_to_use: "Always run this before executing an unknown exploit from searchsploit or GitHub. Public exploits may contain backdoors, destructive operations, or require specific dependencies. The analysis output tells you: (1) What language it's in (determines run method), (2) What pip packages are needed (pass to prepare_exploit), (3) Whether it has dangerous patterns to review, (4) Whether it makes network connections (needs target info as args)."
    params:
      script:
        type: string
        required: true
        description: "Exploit script content"
      language:
        type: enum
        values: [python, ruby, shell, auto]
        default: "auto"
        description: "Script language"
    returns:
      language:
        type: string
        description: "Detected language"
      imports:
        type: array
        description: "Imported modules"
      dangerous_patterns:
        type: array
        description: "Potentially dangerous operations"
      likely_requirements:
        type: array
        description: "Likely pip requirements"

  # Template-based exploit methods
  list_templates:
    description: "List available parameterized exploit templates"
    when_to_use: "To see what CVE exploits are available as templates"
    params:
      cve:
        type: string
        description: "Filter by CVE ID"
      software:
        type: string
        description: "Filter by affected software"
      severity:
        type: string
        enum: [critical, high, medium, low]
        description: "Filter by severity"
      tag:
        type: string
        description: "Filter by tag"
    returns:
      templates:
        type: array
        description: "List of exploit templates"
      total:
        type: integer
        description: "Number of templates found"

  get_template:
    description: "Get details of a specific exploit template"
    when_to_use: "To see what parameters an exploit template needs"
    params:
      template_id:
        type: string
        required: true
        description: "Template ID"
    returns:
      id:
        type: string
        description: "Template ID"
      name:
        type: string
        description: "Template name"
      cve:
        type: string
        description: "CVE identifier"
      parameters:
        type: array
        description: "Required parameters"
      description:
        type: string
        description: "Full description"

  search_templates:
    description: "Search for exploit templates by software/version"
    when_to_use: "To find exploits for a specific software you discovered"
    params:
      software:
        type: string
        required: true
        description: "Software name (e.g., 'jenkins', 'log4j')"
      version:
        type: string
        description: "Version string"
    returns:
      matches:
        type: array
        description: "Matching templates"
      total:
        type: integer
        description: "Number of matches"

  run_template:
    description: "Execute an exploit template with parameters"
    when_to_use: "To run a CVE exploit by filling in target-specific parameters"
    params:
      template_id:
        type: string
        required: true
        description: "Template ID (e.g., 'log4shell', 'cacti-cmd-injection')"
      params:
        type: object
        required: true
        description: "Exploit parameters (target_url, command, etc.)"
      timeout:
        type: integer
        default: 120
        description: "Execution timeout"
    returns:
      output:
        type: string
        description: "Exploit output"
      success:
        type: boolean
        description: "Whether exploit succeeded"
      indicators_matched:
        type: array
        description: "Success indicators found in output"

  generate_payload:
    description: "Generate reverse shell, bind shell, or command execution payloads in bash, Python, or PHP. Returns both raw payload and base64-encoded version. Bash reverse shell uses '/dev/tcp', Python uses socket+subprocess, PHP uses fsockopen. Bind shells use netcat. All payloads target /bin/sh."
    when_to_use: "When you need a payload for an RCE vulnerability. Common workflow: (1) Confirm RCE via curl inject with a simple 'id' command, (2) generate_payload for a reverse shell, (3) Start a listener with netcat tool, (4) Deliver the payload via the RCE. Choose language based on what's available on the target: bash (most Linux systems), python (if Python installed), php (if PHP web server). The base64 output is useful for encoding payloads to avoid special character issues."
    params:
      payload_type:
        type: string
        required: true
        enum: [reverse_shell, bind_shell, command]
        description: "Type of payload"
      lhost:
        type: string
        description: "Attacker IP for reverse shells"
      lport:
        type: integer
        description: "Attacker port"
      command:
        type: string
        description: "Command for command payloads"
      language:
        type: string
        default: "bash"
        enum: [bash, python, php]
        description: "Payload language"
    returns:
      payload:
        type: string
        description: "Generated payload"
      payload_base64:
        type: string
        description: "Base64 encoded payload"

# =============================================================================
# IKE / IPSEC / VPN
# =============================================================================
