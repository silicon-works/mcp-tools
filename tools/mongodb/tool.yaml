name: mongodb
version: "1.0"
description: "MongoDB client (pymongo 4.16.0) for remote database enumeration and data extraction over the network. Connects to MongoDB servers (default port 27017) with optional username/password authentication against a specified auth database. Supports both authenticated and unauthenticated access — many MongoDB instances found during pentesting have no authentication enabled. Includes automated credential hunting that pattern-matches collection names (users, accounts, admins, credentials, auth, login, passwords) and field names (password, hash, token, api_key, secret) across all databases. Also provides server fingerprinting (version, storage engines, modules, JS engine)."
image: "ghcr.io/silicon-works/mcp-tools-mongodb:latest"
image_size_mb: 250
timeout_seconds: 120

capabilities:
  - database_enumeration
  - nosql_access
  - credential_extraction
  - data_exfiltration

phases:
  - enumeration
  - post-exploitation

requirements:
  network: true
  privileged: false

resources:
  memory_mb: 256
  cpu: 0.5

# Routing hints for tool selection
routing:
  use_for:
    - "MongoDB database enumeration and data extraction"
    - "connect to unauthenticated MongoDB instance on port 27017"
    - "extract credentials from MongoDB collections"
    - "enumerate MongoDB databases and collections"
    - "NoSQL database access and document retrieval"
    - "MongoDB server fingerprinting and version detection"
    - "query MongoDB documents with filter and projection"
    - "dump MongoDB collection contents"
    - "search for passwords tokens secrets in MongoDB"
    - "post-exploitation MongoDB data exfiltration"
    - "connect to MongoDB using connection string URI"
    - "MongoDB TLS encrypted connection"
  never_use_for:
    - "SQL databases (use mysql or sqlite)"
    - "NoSQL injection (use nosqlmap)"
    - "port scanning"
  triggers:
    - "MongoDB"
    - "NoSQL"
    - "mongo"
    - "port 27017"
    - "BSON"
    - "document database"

methods:
  connect:
    description: "Test connection to a MongoDB server by sending a ping command to the admin database and retrieving server_info(). Verifies whether the server accepts unauthenticated connections or requires credentials. Returns the MongoDB server version and whether authentication was used. Supports TLS connections and direct URI connection strings."
    when_to_use: "First step when nmap discovers port 27017 (or another MongoDB port) open. Tests whether the MongoDB instance allows unauthenticated access (common misconfiguration) or requires credentials. Try without username/password first — if it succeeds, the server has no auth and you can proceed to list_databases. If it fails with 'Authentication failed', try known credentials or default credentials. If you found a MongoDB connection string in a config file, pass it via the uri param."
    params:
      host:
        type: string
        description: "MongoDB hostname or IP (e.g., '10.10.10.1', 'target.htb'). Not required if uri is provided."
      port:
        type: integer
        default: 27017
        description: "MongoDB port (default 27017). Nmap may find MongoDB on non-standard ports."
      username:
        type: string
        description: "Username for authentication. Omit to test unauthenticated access. Common defaults: 'admin', 'root', 'mongodb'."
      password:
        type: string
        description: "Password for authentication. Omit to test unauthenticated access."
      auth_db:
        type: string
        default: admin
        description: "Authentication database — the database that contains the user credentials. Default 'admin'. Some apps use their own database for auth (e.g., 'myapp')."
      uri:
        type: string
        description: "Full MongoDB connection string URI (e.g., 'mongodb://user:pass@host:27017/db?authSource=admin'). If provided, overrides host/port/username/password/auth_db params. Useful when you find a connection string in config files."
      tls:
        type: boolean
        default: false
        description: "Enable TLS for the connection. Required for MongoDB instances configured with TLS/SSL."
      tls_insecure:
        type: boolean
        default: false
        description: "Allow invalid TLS certificates and hostnames (for self-signed certs). Only effective when tls=true."
      timeout:
        type: integer
        default: 5
        description: "Connection timeout in seconds. Increase to 10-15 for slow/remote connections."
    returns:
      connected:
        type: boolean
        description: "Whether the connection and ping succeeded"
      version:
        type: string
        description: "MongoDB server version (e.g., '7.0.14', '6.0.12', '4.4.29')"
      authenticated:
        type: boolean
        description: "Whether authentication credentials were provided"

  list_databases:
    description: "List all databases on the MongoDB server with their sizes. Returns each database's name, size on disk (bytes), and whether it's empty. Equivalent to 'show dbs' in the mongo shell."
    when_to_use: "After successful connection to enumerate all databases on the server. Look for application databases (not admin/config/local system databases) that may contain user data, credentials, or sensitive information. Database names often reveal the application (e.g., 'wordpress', 'app_production', 'users_db')."
    params:
      host:
        type: string
        description: "MongoDB hostname or IP (not required if uri is provided)"
      port:
        type: integer
        default: 27017
        description: "MongoDB port"
      username:
        type: string
        description: "Username for authentication (omit for unauthenticated access)"
      password:
        type: string
        description: "Password for authentication"
      auth_db:
        type: string
        default: admin
        description: "Authentication database"
      uri:
        type: string
        description: "Full MongoDB connection string URI. Overrides host/port/username/password/auth_db."
      tls:
        type: boolean
        default: false
        description: "Enable TLS for the connection"
      tls_insecure:
        type: boolean
        default: false
        description: "Allow invalid TLS certificates and hostnames"
    returns:
      databases:
        type: array
        description: "List of databases, each with 'name', 'sizeOnDisk' (bytes), and 'empty' (boolean)"
      count:
        type: integer
        description: "Total number of databases"

  list_collections:
    description: "List all collection names in a specific database. Equivalent to 'show collections' in the mongo shell. Collections are MongoDB's equivalent of SQL tables."
    when_to_use: "After list_databases identifies interesting application databases. Collection names reveal the data model — look for collections like 'users', 'accounts', 'sessions', 'tokens', 'config', 'secrets' that may contain credentials or sensitive data."
    params:
      host:
        type: string
        description: "MongoDB hostname or IP (not required if uri is provided)"
      database:
        type: string
        required: true
        description: "Database name (from list_databases output)"
      port:
        type: integer
        default: 27017
        description: "MongoDB port"
      username:
        type: string
        description: "Username for authentication (omit for unauthenticated access)"
      password:
        type: string
        description: "Password for authentication"
      auth_db:
        type: string
        default: admin
        description: "Authentication database"
      uri:
        type: string
        description: "Full MongoDB connection string URI. Overrides host/port/username/password/auth_db."
      tls:
        type: boolean
        default: false
        description: "Enable TLS for the connection"
      tls_insecure:
        type: boolean
        default: false
        description: "Allow invalid TLS certificates and hostnames"
    returns:
      collections:
        type: array
        description: "List of collection name strings"
      count:
        type: integer
        description: "Number of collections in the database"

  query:
    description: "Query documents from a MongoDB collection using filter, projection, and sort. Runs collection.find(filter, projection).sort(sort).limit(N) via pymongo. ObjectIds are auto-serialized to strings, bytes to hex. Returns documents as JSON-serializable dictionaries."
    when_to_use: "When you need to retrieve specific documents matching criteria — e.g., find admin users, search for specific email addresses, find documents with password fields. Use filter for matching and projection to select only needed fields (reduces output size). Use sort to order results (e.g., newest first). For dumping all documents without filtering, use dump_collection instead."
    params:
      host:
        type: string
        description: "MongoDB hostname or IP (not required if uri is provided)"
      database:
        type: string
        required: true
        description: "Database name"
      collection:
        type: string
        required: true
        description: "Collection name"
      filter:
        type: object
        default: {}
        description: "MongoDB query filter as JSON object. Examples: {} (all docs), {\"role\": \"admin\"} (exact match), {\"email\": {\"$regex\": \"@company.com\"}} (regex), {\"password\": {\"$exists\": true}} (has field), {\"age\": {\"$gt\": 18}} (comparison). Supports all MongoDB query operators ($eq, $ne, $gt, $lt, $in, $regex, $exists, $or, $and)."
      projection:
        type: object
        description: "Fields to include or exclude from results. Use {\"field\": 1} to include or {\"field\": 0} to exclude. Examples: {\"username\": 1, \"password\": 1} (only these fields + _id), {\"_id\": 0, \"largeBlob\": 0} (exclude specific fields). Cannot mix include and exclude (except _id)."
      sort:
        type: object
        description: "Sort order as JSON object. Use 1 for ascending, -1 for descending. Examples: {\"created_at\": -1} for newest first, {\"username\": 1} for alphabetical, {\"score\": -1, \"name\": 1} for multi-field sort."
      limit:
        type: integer
        default: 100
        description: "Maximum documents to return. Default 100. Set to 0 for no limit (careful with large collections)."
      port:
        type: integer
        default: 27017
        description: "MongoDB port"
      username:
        type: string
        description: "Username for authentication (omit for unauthenticated access)"
      password:
        type: string
        description: "Password for authentication"
      auth_db:
        type: string
        default: admin
        description: "Authentication database"
      uri:
        type: string
        description: "Full MongoDB connection string URI. Overrides host/port/username/password/auth_db."
      tls:
        type: boolean
        default: false
        description: "Enable TLS for the connection"
      tls_insecure:
        type: boolean
        default: false
        description: "Allow invalid TLS certificates and hostnames"
    returns:
      documents:
        type: array
        description: "Matching documents as dictionaries (ObjectIds serialized to strings, bytes to hex)"
      count:
        type: integer
        description: "Number of documents returned"

  dump_collection:
    description: "Dump all documents from a collection (shorthand for query with empty filter). Internally calls query with filter={} and the specified limit. Use this for quick full-collection extraction without needing to construct a filter."
    when_to_use: "After identifying interesting collections via list_collections, use this to extract all documents. Simpler than query when you don't need filtering or projection — just dumps everything up to the limit. For credential collections, consider using find_credentials instead which auto-detects credential fields across multiple collections."
    params:
      host:
        type: string
        description: "MongoDB hostname or IP (not required if uri is provided)"
      database:
        type: string
        required: true
        description: "Database name"
      collection:
        type: string
        required: true
        description: "Collection name to dump"
      limit:
        type: integer
        default: 100
        description: "Maximum documents to return. Default 100. Increase for small collections, keep low to sample large ones."
      port:
        type: integer
        default: 27017
        description: "MongoDB port"
      username:
        type: string
        description: "Username for authentication (omit for unauthenticated access)"
      password:
        type: string
        description: "Password for authentication"
      auth_db:
        type: string
        default: admin
        description: "Authentication database"
      uri:
        type: string
        description: "Full MongoDB connection string URI. Overrides host/port/username/password/auth_db."
      tls:
        type: boolean
        default: false
        description: "Enable TLS for the connection"
      tls_insecure:
        type: boolean
        default: false
        description: "Allow invalid TLS certificates and hostnames"
    returns:
      documents:
        type: array
        description: "All documents from the collection (up to limit), serialized as JSON dictionaries"
      count:
        type: integer
        description: "Number of documents returned"

  find_credentials:
    description: "Automatically search for credential-related data across databases and collections. Two-pass search: first scans collections whose names match 14 credential patterns (users, accounts, members, admins, credentials, auth, login, passwords, etc.), then scans ALL remaining collections for documents containing credential-like field names (password, hash, token, api_key, secret, etc.). This second pass catches credentials stored in non-obviously-named collections (e.g., 'staff', 'people', 'data'). Returns up to 5 sample documents per matching collection with match_type indicating how it was found ('collection_name' or 'field_pattern')."
    when_to_use: "First thing to run after connecting to a MongoDB server to automatically find stored credentials. Searches across ALL non-system databases so you don't need to enumerate databases/collections manually first. The two-pass approach means it won't miss credentials even if they're in collections with non-obvious names. If this returns no results, fall back to manual enumeration: list_databases → list_collections → dump_collection on interesting collections."
    params:
      host:
        type: string
        description: "MongoDB hostname or IP (not required if uri is provided)"
      database:
        type: string
        description: "Specific database to search. If omitted, searches ALL non-system databases (admin, config, local are excluded). Specify a database to narrow the search."
      port:
        type: integer
        default: 27017
        description: "MongoDB port"
      username:
        type: string
        description: "Username for authentication (omit for unauthenticated access)"
      password:
        type: string
        description: "Password for authentication"
      auth_db:
        type: string
        default: admin
        description: "Authentication database"
      uri:
        type: string
        description: "Full MongoDB connection string URI. Overrides host/port/username/password/auth_db."
      tls:
        type: boolean
        default: false
        description: "Enable TLS for the connection"
      tls_insecure:
        type: boolean
        default: false
        description: "Allow invalid TLS certificates and hostnames"
    returns:
      findings:
        type: array
        description: "Matching collections, each with: 'database' name, 'collection' name, 'document_count' (total docs in collection), 'has_credential_fields' (boolean), 'match_type' ('collection_name' if matched by name, 'field_pattern' if matched by field content), 'sample_documents' (up to 5 sample docs with all fields)"
      databases_searched:
        type: array
        description: "List of database names that were searched"
      total_findings:
        type: integer
        description: "Number of matching collections found"

  server_info:
    description: "Get detailed MongoDB server information by running server_info() and buildInfo admin commands. Returns version, git version, architecture (32/64-bit), loaded modules (e.g., enterprise), available storage engines (e.g., wiredTiger, ephemeralForTest), JavaScript engine, and max BSON object size."
    when_to_use: "To fingerprint the MongoDB installation after connecting. The version is important for: identifying known CVEs (e.g., pre-auth RCE in older versions), determining available features, and reporting. Modules list reveals if this is MongoDB Community or Enterprise. Storage engine info helps understand the deployment. Also useful when connect already succeeded but you want more details."
    params:
      host:
        type: string
        description: "MongoDB hostname or IP (not required if uri is provided)"
      port:
        type: integer
        default: 27017
        description: "MongoDB port"
      username:
        type: string
        description: "Username for authentication (omit for unauthenticated access)"
      password:
        type: string
        description: "Password for authentication"
      auth_db:
        type: string
        default: admin
        description: "Authentication database"
      uri:
        type: string
        description: "Full MongoDB connection string URI. Overrides host/port/username/password/auth_db."
      tls:
        type: boolean
        default: false
        description: "Enable TLS for the connection"
      tls_insecure:
        type: boolean
        default: false
        description: "Allow invalid TLS certificates and hostnames"
    returns:
      version:
        type: string
        description: "MongoDB server version (e.g., '7.0.14')"
      git_version:
        type: string
        description: "Git commit hash of the server build"
      modules:
        type: array
        description: "Loaded modules (empty for Community, ['enterprise'] for Enterprise)"
      bits:
        type: integer
        description: "Architecture: 32 or 64 bit"
      storage_engines:
        type: array
        description: "Available storage engines (e.g., ['devnull', 'ephemeralForTest', 'wiredTiger'])"
      javascript_engine:
        type: string
        description: "JavaScript engine used (e.g., 'mozjs')"
      max_bson_object_size:
        type: integer
        description: "Maximum BSON document size in bytes (default 16MB)"
