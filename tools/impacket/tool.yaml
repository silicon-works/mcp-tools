name: impacket
version: "0.12"
description: "Windows/Active Directory exploitation toolkit for remote execution, credential dumping, Kerberos attacks, and SMB operations"
image: "ghcr.io/silicon-works/mcp-tools-impacket:latest"
image_size_mb: 900

capabilities:
  - remote_execution
  - credential_dumping
  - pass_the_hash
  - kerberos_attacks
  - smb_operations
  - ad_enumeration

phases:
  - enumeration
  - exploitation
  - post-exploitation

requirements:
  network: true
  privileged: false

resources:
  memory_mb: 512
  cpu: 0.5

routing:
  use_for:
    - "Windows remote command execution"
    - "pass-the-hash authentication"
    - "NTLM hash pass-the-hash"
    - "credential dumping from Windows"
    - "SAM database extraction"
    - "NTDS.dit dump"
    - "secretsdump"
    - "kerberoasting"
    - "AS-REP roasting"
    - "SMB share enumeration"
    - "SMB file transfer"
    - "Active Directory user enumeration"
    - "SID enumeration"
    - "Kerberos TGT request"
    - "Windows lateral movement"
    - "psexec wmiexec smbexec"
  never_use_for:
    - "Linux-only targets"
    - "port scanning"
    - "web application testing"
    - "SQL injection"
    - "password brute-forcing (use hydra instead)"
    - "vulnerability scanning"
  triggers:
    - "impacket"
    - "psexec"
    - "wmiexec"
    - "smbexec"
    - "dcomexec"
    - "atexec"
    - "secretsdump"
    - "kerberoast"
    - "asreproast"
    - "pass-the-hash"
    - "pass the hash"
    - "pth"
    - "ntlm hash"
    - "GetUserSPNs"
    - "GetNPUsers"
    - "GetADUsers"
    - "lookupsid"
    - "getTGT"
  prefer_over: []

methods:
  psexec:
    description: "Execute commands on a remote Windows host via PsExec (creates a service, most reliable but noisy)"
    when_to_use: "When reliable remote execution is needed and stealth is not critical. Uses SMB service creation."
    params:
      target:
        type: string
        required: true
        description: "Target IP address or hostname"
      username:
        type: string
        description: "Username for authentication"
      password:
        type: string
        description: "Password for authentication"
      domain:
        type: string
        description: "Active Directory domain name"
      hashes:
        type: string
        description: "NTLM hash in LM:NT format for pass-the-hash"
      kerberos:
        type: boolean
        default: false
        description: "Use Kerberos authentication"
      dc_ip:
        type: string
        description: "Domain Controller IP"
      aes_key:
        type: string
        description: "AES key for Kerberos authentication"
      port:
        type: integer
        description: "Target SMB port (default: 445)"
      command:
        type: string
        description: "Command to execute (omit for interactive shell)"
      service_name:
        type: string
        description: "Custom service name for stealth"
      codec:
        type: string
        default: "utf-8"
        description: "Output codec"
      timeout:
        type: integer
        default: 120
        description: "Timeout in seconds"
    returns:
      method:
        type: string
        description: "Execution method used (psexec)"
      output:
        type: string
        description: "Command output"
      info:
        type: array
        description: "Informational messages"
      warnings:
        type: array
        description: "Warning messages"

  wmiexec:
    description: "Execute commands on a remote Windows host via WMI (stealthier than psexec, no service creation)"
    when_to_use: "When stealth matters - no service creation, uses WMI for execution. Preferred for lateral movement."
    params:
      target:
        type: string
        required: true
        description: "Target IP address or hostname"
      username:
        type: string
        description: "Username for authentication"
      password:
        type: string
        description: "Password for authentication"
      domain:
        type: string
        description: "Active Directory domain name"
      hashes:
        type: string
        description: "NTLM hash in LM:NT format for pass-the-hash"
      kerberos:
        type: boolean
        default: false
        description: "Use Kerberos authentication"
      dc_ip:
        type: string
        description: "Domain Controller IP"
      aes_key:
        type: string
        description: "AES key for Kerberos authentication"
      port:
        type: integer
        description: "Target port (default: 135 for WMI)"
      command:
        type: string
        description: "Command to execute"
      nooutput:
        type: boolean
        default: false
        description: "Do not retrieve command output (blind execution)"
      codec:
        type: string
        default: "utf-8"
        description: "Output codec"
      timeout:
        type: integer
        default: 120
        description: "Timeout in seconds"
    returns:
      method:
        type: string
        description: "Execution method used (wmiexec)"
      output:
        type: string
        description: "Command output"

  smbexec:
    description: "Execute commands on a remote Windows host via SMB (native commands, no binary upload needed)"
    when_to_use: "When other methods fail or when you want native command execution without uploading binaries"
    params:
      target:
        type: string
        required: true
        description: "Target IP address or hostname"
      username:
        type: string
        description: "Username for authentication"
      password:
        type: string
        description: "Password for authentication"
      domain:
        type: string
        description: "Active Directory domain name"
      hashes:
        type: string
        description: "NTLM hash in LM:NT format for pass-the-hash"
      kerberos:
        type: boolean
        default: false
        description: "Use Kerberos authentication"
      dc_ip:
        type: string
        description: "Domain Controller IP"
      aes_key:
        type: string
        description: "AES key for Kerberos authentication"
      port:
        type: integer
        description: "Target SMB port (default: 445)"
      command:
        type: string
        description: "Command to execute"
      share:
        type: string
        default: "C$"
        description: "Writable share for output"
      mode:
        type: enum
        values: [SHARE, SERVER]
        default: SHARE
        description: "Execution mode"
      codec:
        type: string
        default: "utf-8"
        description: "Output codec"
      timeout:
        type: integer
        default: 120
        description: "Timeout in seconds"
    returns:
      method:
        type: string
        description: "Execution method used (smbexec)"
      output:
        type: string
        description: "Command output"

  dcomexec:
    description: "Execute commands on a remote Windows host via DCOM objects (MMC20, ShellWindows, ShellBrowserWindow)"
    when_to_use: "Alternative lateral movement using DCOM. Useful when SMB-based methods are blocked."
    params:
      target:
        type: string
        required: true
        description: "Target IP address or hostname"
      username:
        type: string
        description: "Username for authentication"
      password:
        type: string
        description: "Password for authentication"
      domain:
        type: string
        description: "Active Directory domain name"
      hashes:
        type: string
        description: "NTLM hash in LM:NT format for pass-the-hash"
      kerberos:
        type: boolean
        default: false
        description: "Use Kerberos authentication"
      dc_ip:
        type: string
        description: "Domain Controller IP"
      aes_key:
        type: string
        description: "AES key for Kerberos authentication"
      port:
        type: integer
        description: "Target port (default: 135 for DCOM)"
      command:
        type: string
        description: "Command to execute"
      dcom_object:
        type: enum
        values: [MMC20, ShellWindows, ShellBrowserWindow]
        default: MMC20
        description: "DCOM object to use for execution"
      nooutput:
        type: boolean
        default: false
        description: "Do not retrieve command output"
      codec:
        type: string
        default: "utf-8"
        description: "Output codec"
      timeout:
        type: integer
        default: 120
        description: "Timeout in seconds"
    returns:
      method:
        type: string
        description: "Execution method used (dcomexec)"
      object:
        type: string
        description: "DCOM object used"
      output:
        type: string
        description: "Command output"

  atexec:
    description: "Execute commands on a remote Windows host via Task Scheduler (scheduled task based execution)"
    when_to_use: "When other execution methods are blocked. Uses Windows Task Scheduler for command execution."
    params:
      target:
        type: string
        required: true
        description: "Target IP address or hostname"
      command:
        type: string
        required: true
        description: "Command to execute via scheduled task"
      username:
        type: string
        description: "Username for authentication"
      password:
        type: string
        description: "Password for authentication"
      domain:
        type: string
        description: "Active Directory domain name"
      hashes:
        type: string
        description: "NTLM hash in LM:NT format for pass-the-hash"
      kerberos:
        type: boolean
        default: false
        description: "Use Kerberos authentication"
      dc_ip:
        type: string
        description: "Domain Controller IP"
      aes_key:
        type: string
        description: "AES key for Kerberos authentication"
      port:
        type: integer
        description: "Target SMB port (default: 445)"
      codec:
        type: string
        default: "utf-8"
        description: "Output codec"
      timeout:
        type: integer
        default: 120
        description: "Timeout in seconds"
    returns:
      method:
        type: string
        description: "Execution method used (atexec)"
      output:
        type: string
        description: "Command output"

  secretsdump:
    description: "Dump credentials from a Windows host (SAM, LSA secrets, cached creds, NTDS.dit via DRSUAPI/VSS)"
    when_to_use: "After gaining admin access to dump password hashes. Use -just-dc on domain controllers for NTDS.dit."
    params:
      target:
        type: string
        required: true
        description: "Target IP address or hostname"
      username:
        type: string
        description: "Username for authentication (needs admin privileges)"
      password:
        type: string
        description: "Password for authentication"
      domain:
        type: string
        description: "Active Directory domain name"
      hashes:
        type: string
        description: "NTLM hash in LM:NT format for pass-the-hash"
      kerberos:
        type: boolean
        default: false
        description: "Use Kerberos authentication"
      dc_ip:
        type: string
        description: "Domain Controller IP"
      aes_key:
        type: string
        description: "AES key for Kerberos authentication"
      port:
        type: integer
        description: "Target SMB port (default: 445)"
      just_dc:
        type: boolean
        default: false
        description: "Only extract NTDS.dit data via DRSUAPI (DC only, much faster)"
      just_dc_ntlm:
        type: boolean
        default: false
        description: "Only extract NTLM hashes from NTDS.dit"
      just_dc_user:
        type: string
        description: "Extract only this user's hash from NTDS.dit"
      use_vss:
        type: boolean
        default: false
        description: "Use Volume Shadow Copy instead of DRSUAPI"
      exec_method:
        type: enum
        values: [smbexec, wmiexec, mmcexec]
        description: "Remote execution method for VSS"
      timeout:
        type: integer
        default: 600
        description: "Timeout in seconds (credential dumping can be slow)"
    returns:
      sam_hashes:
        type: array
        description: "Local SAM hashes (user:rid:lm:nt:::)"
      lsa_secrets:
        type: array
        description: "LSA secrets"
      cached_creds:
        type: array
        description: "Domain cached credentials"
      ntds_hashes:
        type: array
        description: "NTDS.dit hashes (domain controller)"
      kerberos_keys:
        type: array
        description: "Kerberos encryption keys"
      total_hashes:
        type: integer
        description: "Total number of hashes extracted"

  kerberoast:
    description: "Kerberoasting attack - extract TGS service ticket hashes for offline cracking (targets accounts with SPNs)"
    when_to_use: "With any valid domain credentials to extract service account hashes for offline cracking"
    params:
      target:
        type: string
        required: true
        description: "Target domain or DC IP (format: domain/user:pass@dc_ip or just dc_ip)"
      username:
        type: string
        description: "Domain username"
      password:
        type: string
        description: "Domain password"
      domain:
        type: string
        description: "Active Directory domain name"
      hashes:
        type: string
        description: "NTLM hash in LM:NT format"
      kerberos:
        type: boolean
        default: false
        description: "Use Kerberos authentication"
      dc_ip:
        type: string
        description: "Domain Controller IP"
      aes_key:
        type: string
        description: "AES key for Kerberos authentication"
      port:
        type: integer
        description: "Target port"
      request_user:
        type: string
        description: "Target a specific user's SPN"
      output_format:
        type: enum
        values: [hashcat, john]
        default: hashcat
        description: "Hash output format for cracking"
      timeout:
        type: integer
        default: 120
        description: "Timeout in seconds"
    returns:
      hashes:
        type: array
        description: "TGS hashes in requested format (hashcat/john)"
      hash_count:
        type: integer
        description: "Number of hashes extracted"
      users_with_spns:
        type: array
        description: "Users with SPNs (spn, username, member_of, pwd_last_set)"
      user_count:
        type: integer
        description: "Number of users with SPNs found"

  asreproast:
    description: "AS-REP Roasting - extract hashes for accounts with Kerberos pre-authentication disabled"
    when_to_use: "To find accounts without Kerberos pre-authentication and extract their hashes for cracking"
    params:
      target:
        type: string
        required: true
        description: "Target domain or DC IP"
      username:
        type: string
        description: "Domain username (or blank for unauthenticated with usersfile)"
      password:
        type: string
        description: "Domain password"
      domain:
        type: string
        description: "Active Directory domain name"
      hashes:
        type: string
        description: "NTLM hash in LM:NT format"
      kerberos:
        type: boolean
        default: false
        description: "Use Kerberos authentication"
      dc_ip:
        type: string
        description: "Domain Controller IP"
      aes_key:
        type: string
        description: "AES key for Kerberos authentication"
      port:
        type: integer
        description: "Target port"
      usersfile:
        type: string
        description: "File with list of usernames to test (one per line)"
      output_format:
        type: enum
        values: [hashcat, john]
        default: hashcat
        description: "Hash output format for cracking"
      timeout:
        type: integer
        default: 120
        description: "Timeout in seconds"
    returns:
      hashes:
        type: array
        description: "AS-REP hashes in requested format"
      hash_count:
        type: integer
        description: "Number of hashes extracted"
      vulnerable_users:
        type: array
        description: "Users without pre-authentication"

  smb_shares:
    description: "List SMB shares on a remote Windows host with access permissions"
    when_to_use: "To enumerate available SMB shares before accessing files"
    params:
      target:
        type: string
        required: true
        description: "Target IP address or hostname"
      username:
        type: string
        description: "Username for authentication"
      password:
        type: string
        description: "Password for authentication"
      domain:
        type: string
        description: "Active Directory domain name"
      hashes:
        type: string
        description: "NTLM hash in LM:NT format"
      kerberos:
        type: boolean
        default: false
        description: "Use Kerberos authentication"
      dc_ip:
        type: string
        description: "Domain Controller IP"
      aes_key:
        type: string
        description: "AES key for Kerberos authentication"
      port:
        type: integer
        description: "Target SMB port (default: 445)"
      timeout:
        type: integer
        default: 60
        description: "Timeout in seconds"
    returns:
      shares:
        type: array
        description: "Available shares with name, type, and comment"
      share_count:
        type: integer
        description: "Number of shares found"

  smb_get:
    description: "Download a file from an SMB share"
    when_to_use: "To retrieve files from Windows shares (config files, scripts, sensitive data)"
    params:
      target:
        type: string
        required: true
        description: "Target IP address or hostname"
      share:
        type: string
        required: true
        description: "Share name (e.g., 'C$', 'Users', 'SYSVOL')"
      remote_path:
        type: string
        required: true
        description: "Path within the share"
      username:
        type: string
        description: "Username for authentication"
      password:
        type: string
        description: "Password for authentication"
      domain:
        type: string
        description: "Active Directory domain name"
      hashes:
        type: string
        description: "NTLM hash in LM:NT format"
      kerberos:
        type: boolean
        default: false
        description: "Use Kerberos authentication"
      dc_ip:
        type: string
        description: "Domain Controller IP"
      aes_key:
        type: string
        description: "AES key for Kerberos authentication"
      port:
        type: integer
        description: "Target SMB port (default: 445)"
      timeout:
        type: integer
        default: 120
        description: "Timeout in seconds"
    returns:
      content:
        type: string
        description: "File content"
      size:
        type: integer
        description: "File size in bytes"

  smb_put:
    description: "Upload content to an SMB share"
    when_to_use: "To upload files to Windows shares (payloads, scripts, tools)"
    params:
      target:
        type: string
        required: true
        description: "Target IP address or hostname"
      share:
        type: string
        required: true
        description: "Share name (e.g., 'C$', 'Users')"
      remote_path:
        type: string
        required: true
        description: "Destination path within the share"
      content:
        type: string
        required: true
        description: "Content to upload"
      username:
        type: string
        description: "Username for authentication"
      password:
        type: string
        description: "Password for authentication"
      domain:
        type: string
        description: "Active Directory domain name"
      hashes:
        type: string
        description: "NTLM hash in LM:NT format"
      kerberos:
        type: boolean
        default: false
        description: "Use Kerberos authentication"
      dc_ip:
        type: string
        description: "Domain Controller IP"
      aes_key:
        type: string
        description: "AES key for Kerberos authentication"
      port:
        type: integer
        description: "Target SMB port (default: 445)"
      timeout:
        type: integer
        default: 120
        description: "Timeout in seconds"
    returns:
      size:
        type: integer
        description: "Uploaded content size in bytes"

  get_ad_users:
    description: "Enumerate Active Directory users via LDAP (requires domain credentials)"
    when_to_use: "During enumeration phase to discover domain users for targeting"
    params:
      target:
        type: string
        required: true
        description: "Target domain or DC IP"
      username:
        type: string
        description: "Domain username"
      password:
        type: string
        description: "Domain password"
      domain:
        type: string
        description: "Active Directory domain name"
      hashes:
        type: string
        description: "NTLM hash in LM:NT format"
      kerberos:
        type: boolean
        default: false
        description: "Use Kerberos authentication"
      dc_ip:
        type: string
        description: "Domain Controller IP"
      aes_key:
        type: string
        description: "AES key for Kerberos authentication"
      port:
        type: integer
        description: "Target LDAP port"
      all:
        type: boolean
        default: false
        description: "Return all user attributes (verbose)"
      timeout:
        type: integer
        default: 120
        description: "Timeout in seconds"
    returns:
      users:
        type: array
        description: "AD users with name, email, and creation date"
      user_count:
        type: integer
        description: "Number of users found"

  lookupsid:
    description: "Brute-force SID enumeration to discover domain users, groups, and aliases"
    when_to_use: "To enumerate domain objects when LDAP is restricted or for initial domain recon"
    params:
      target:
        type: string
        required: true
        description: "Target IP address or hostname"
      username:
        type: string
        description: "Username for authentication"
      password:
        type: string
        description: "Password for authentication"
      domain:
        type: string
        description: "Active Directory domain name"
      hashes:
        type: string
        description: "NTLM hash in LM:NT format"
      kerberos:
        type: boolean
        default: false
        description: "Use Kerberos authentication"
      dc_ip:
        type: string
        description: "Domain Controller IP"
      aes_key:
        type: string
        description: "AES key for Kerberos authentication"
      port:
        type: integer
        description: "Target SMB port (default: 445)"
      max_rid:
        type: integer
        default: 4000
        description: "Maximum RID to enumerate"
      timeout:
        type: integer
        default: 120
        description: "Timeout in seconds"
    returns:
      domain_sid:
        type: string
        description: "Domain SID"
      users:
        type: array
        description: "Discovered users with RID, name, and type"
      groups:
        type: array
        description: "Discovered groups"
      aliases:
        type: array
        description: "Discovered aliases"
      total:
        type: integer
        description: "Total objects discovered"

  get_tgt:
    description: "Request a Kerberos TGT and save the ccache file for pass-the-ticket attacks"
    when_to_use: "To obtain a TGT for Kerberos-based attacks or when needing to authenticate via tickets"
    params:
      target:
        type: string
        required: true
        description: "Target domain or DC IP"
      username:
        type: string
        description: "Domain username"
      password:
        type: string
        description: "Domain password"
      domain:
        type: string
        description: "Active Directory domain name"
      hashes:
        type: string
        description: "NTLM hash in LM:NT format"
      kerberos:
        type: boolean
        default: false
        description: "Use Kerberos authentication"
      dc_ip:
        type: string
        description: "Domain Controller IP"
      aes_key:
        type: string
        description: "AES key for Kerberos authentication"
      port:
        type: integer
        description: "Target port"
      timeout:
        type: integer
        default: 60
        description: "Timeout in seconds"
    returns:
      ccache_file:
        type: string
        description: "Path to saved ccache file"
      ccache_exists:
        type: boolean
        description: "Whether ccache file was saved successfully"
      hint:
        type: string
        description: "Usage hint for the ccache file"
