name: privesc
version: "1.0"
description: "Linux privilege escalation enumeration and exploit suggestion tool that checks SUID/SGID binaries against GTFOBins, sudo misconfigurations, Linux capabilities, cron jobs, writable sensitive files, and matches kernel/software versions against a built-in CVE database (Dirty Pipe, Dirty COW, PwnKit, Baron Samedit). Also provides linpeas.sh and linux-smart-enumeration scripts for upload to target."
image: "ghcr.io/silicon-works/mcp-tools-privesc:latest"
image_size_mb: 200

capabilities:
  - privilege_escalation_enumeration
  - suid_analysis
  - sudo_analysis
  - capability_analysis
  - cve_lookup

phases:
  - post-exploitation

requirements:
  network: false
  privileged: false

resources:
  memory_mb: 256
  cpu: 0.5

# Routing hints for tool selection
routing:
  use_for:
    - "privilege escalation enumeration"
    - "SUID SGID binary analysis and GTFOBins check"
    - "sudo misconfiguration and NOPASSWD detection"
    - "Linux capability abuse detection"
    - "cron job enumeration and writable script detection"
    - "Linux privilege escalation"
    - "kernel exploit suggestion Dirty Pipe Dirty COW"
    - "writable sensitive file detection /etc/passwd /etc/shadow"
    - "post-exploitation local enumeration"
    - "linpeas LSE script retrieval"
  never_use_for:
    - "remote scanning"
    - "initial access"
    - "port scanning"
  triggers:
    - "privilege escalation"
    - "privesc"
    - "SUID"
    - "sudo"
    - "linpeas"
    - "root access"
    - "escalate"

methods:
  enumerate:
    description: "Run comprehensive privilege escalation enumeration combining SUID/SGID binary search with GTFOBins matching, sudo permission analysis, Linux capability enumeration, cron job inspection, and writable sensitive file detection. Depth controlled by level parameter: quick runs SUID+sudo only, standard adds capabilities+cron, thorough adds writable file search across /etc and /var."
    when_to_use: "After gaining initial low-privilege shell access on a Linux target to systematically identify all local privilege escalation vectors. This is typically the first tool to run after initial foothold. Use before suggest_exploits (which needs kernel/software info you may discover here)."
    params:
      level:
        type: string
        enum: ["quick", "standard", "thorough"]
        default: "standard"
        description: "Enumeration depth: 'quick' checks SUID binaries and sudo permissions only (fastest, ~30s), 'standard' adds capability and cron job checks (~2min), 'thorough' adds writable file search across /etc and /var (~5min)"
      timeout:
        type: integer
        default: 300
        description: "Overall timeout in seconds for the enumeration"
    returns:
      findings:
        type: array
        description: "Interesting findings flagged as potential privesc vectors (e.g., exploitable SUID binaries, dangerous capabilities)"
      suid:
        type: array
        description: "All SUID binaries found on the system"
      sudo:
        type: object
        description: "Sudo permissions including NOPASSWD entries and commands the user can run"
      capabilities:
        type: array
        description: "Files with Linux capabilities (standard and thorough levels only)"
      cron:
        type: array
        description: "Cron jobs from /etc/crontab and /etc/cron.d/ (standard and thorough levels only)"
      writable:
        type: array
        description: "Writable files in /etc and /var (thorough level only)"
      system_info:
        type: object
        description: "Basic system info: kernel version, architecture, current user ID, hostname"

  check_suid:
    description: "Find all SUID/SGID binaries on the filesystem using 'find / -perm -4000' and cross-reference against a built-in GTFOBins list (nmap, vim, find, bash, less, more, nano, cp, mv, awk, perl, python, ruby, lua, php, node, env, tar, zip, rsync, git, ftp, sftp, scp, pkexec, snap, docker, lxc, ndsudo). Also checks specifically for Netdata ndsudo (CVE-2024-32019 PATH injection)."
    when_to_use: "After gaining shell access to find SUID binaries that can be abused for privilege escalation. Run this when you need a quick check for the most common Linux privesc vector. Results show which binaries match known GTFOBins entries that have SUID exploitation techniques."
    params:
      timeout:
        type: integer
        default: 60
        description: "Timeout in seconds for the filesystem search"
    returns:
      suid_files:
        type: array
        description: "All SUID binary paths found on the system"
      interesting:
        type: array
        description: "SUID binaries matching GTFOBins entries, each with file path, type, and exploitation note"
      count:
        type: integer
        description: "Total number of SUID binaries found"

  check_sudo:
    description: "Check current user's sudo permissions by running 'sudo -l', parsing the output to identify commands runnable as root and NOPASSWD entries. Can optionally supply a password for 'sudo -S -l' when the user requires password authentication for sudo."
    when_to_use: "After gaining shell access to check what commands the current user can run with sudo. NOPASSWD entries are immediate privesc wins. Even password-required sudo entries may be exploitable if the binary has a shell escape (check GTFOBins). Run this early — it's fast and frequently yields the privesc path on HTB machines."
    params:
      password:
        type: string
        description: "User's password to supply via 'sudo -S -l' for accounts that require password authentication. Omit for passwordless sudo check."
      timeout:
        type: integer
        default: 30
        description: "Timeout in seconds (may timeout if password is required but not provided)"
    returns:
      can_run:
        type: array
        description: "Commands the user can run via sudo (lines containing 'may run' or starting with '(')"
      nopasswd:
        type: array
        description: "Commands runnable with NOPASSWD — these are immediate escalation paths"
      raw:
        type: string
        description: "Full raw output of 'sudo -l'"

  check_capabilities:
    description: "Find files with Linux capabilities using 'getcap -r /', flagging dangerous capabilities that enable privilege escalation: cap_setuid (set UID to root), cap_setgid (set GID), cap_dac_override (bypass file permissions), cap_dac_read_search (read any file), cap_sys_admin (mount filesystems, load kernel modules), cap_sys_ptrace (inject into processes), cap_net_admin (network configuration), cap_net_raw (raw sockets)."
    when_to_use: "After gaining shell access to find binaries with Linux capabilities that can be abused for privilege escalation. Capabilities are a finer-grained alternative to SUID — a binary with cap_setuid+ep can escalate to root just like a SUID binary. Common on modern Linux where admins use capabilities instead of SUID. Check GTFOBins for exploitation techniques for the discovered binary+capability combination."
    params:
      timeout:
        type: integer
        default: 60
        description: "Timeout in seconds for the recursive capability search"
    returns:
      files:
        type: array
        description: "All files with capabilities in 'path = capability' format"
      interesting:
        type: array
        description: "Files with dangerous capabilities (cap_setuid, cap_sys_admin, etc.) flagged as potential privesc vectors"
      count:
        type: integer
        description: "Total number of files with capabilities"

  check_cron:
    description: "Enumerate cron jobs by reading /etc/crontab, listing /etc/cron.* directories, and reading all files in /etc/cron.d/. Identifies scheduled tasks that may run as root with writable scripts, writable paths in the command, or wildcard injection opportunities."
    when_to_use: "After gaining shell access to find cron-based privilege escalation opportunities. Look for: cron jobs running as root that execute scripts you can write to, jobs using wildcards in directories you control (wildcard injection), jobs with writable PATH directories, or jobs referencing missing scripts you can create. Pair with check_writable to verify write access to discovered cron script paths."
    params:
      timeout:
        type: integer
        default: 30
        description: "Timeout in seconds"
    returns:
      jobs:
        type: array
        description: "All cron entries and directory listings from /etc/crontab and /etc/cron.d/"
      writable:
        type: array
        description: "Cron scripts identified as writable by current user"

  check_writable:
    description: "Search for writable files in sensitive directories (/etc and /var) using 'find -writable -type f', limited to first 50 results per directory. Writable files in /etc (especially passwd, shadow, sudoers, crontab) or /var (especially log files, web roots, database files) can enable privilege escalation or lateral movement."
    when_to_use: "After gaining shell access to find writable files in sensitive system directories that could be leveraged for privilege escalation. Key targets: /etc/passwd (add root user), /etc/shadow (crack or replace hashes), /etc/sudoers (add sudo entry), /etc/crontab (add root cron job), files in web roots (plant webshell), log files (log poisoning for LFI). This is the slowest check — use as part of thorough enumeration or when other vectors haven't yielded results."
    params:
      timeout:
        type: integer
        default: 120
        description: "Timeout in seconds for the filesystem search"
    returns:
      files:
        type: array
        description: "Writable file paths found in /etc and /var (up to 50 per directory)"
      count:
        type: integer
        description: "Total number of writable files found"

  suggest_exploits:
    description: "Match kernel version and installed software against a built-in CVE database to suggest known privilege escalation exploits. Kernel checks: Dirty Pipe (CVE-2022-0847, kernels 5.8-5.16), Dirty COW (CVE-2016-5195, kernels <5.8). Software checks against database entries for: netdata/ndsudo (CVE-2024-32019), sudo/Baron Samedit (CVE-2021-3156), sudo/pwfeedback (CVE-2019-18634), polkit/PwnKit (CVE-2021-4034), Docker socket escape."
    when_to_use: "After enumerating the target system (using enumerate or manual commands) to match discovered kernel version and installed software against known privilege escalation CVEs. Provide kernel_version from 'uname -r' and installed_software as a list of 'name version' strings (e.g., from 'dpkg -l' or 'rpm -qa'). Best used after enumerate to complement its findings with CVE-based exploit suggestions."
    params:
      kernel_version:
        type: string
        description: "Kernel version string from 'uname -r' (e.g., '5.10.0-20-amd64', '5.15.0-91-generic'). Used to check for kernel exploits like Dirty Pipe (5.8-5.16) and Dirty COW (<5.8)."
      distro:
        type: string
        description: "Distribution info from /etc/os-release PRETTY_NAME (e.g., 'Ubuntu 20.04.6 LTS', 'Debian GNU/Linux 11'). Used for context in suggestions."
      installed_software:
        type: array
        description: "List of installed software with versions as strings. Format: 'name version' (e.g., ['sudo 1.8.31', 'netdata 1.44.0', 'polkit 0.105']). Matched against CVE database categories: netdata, sudo, polkit, kernel, docker."
    returns:
      suggestions:
        type: array
        description: "Matching exploits with name, CVE ID, affected versions, description, and exploitation notes"
      count:
        type: integer
        description: "Number of matching exploit suggestions"

  get_linpeas:
    description: "Retrieve the bundled linpeas.sh script (PEASS-ng) as base64 for upload to target via ssh.upload or shell-session.upload. Linpeas performs comprehensive Linux enumeration across 10 categories: system_information, container (Docker/lxc detection), cloud (AWS/GCP/Azure metadata), procs_crons_timers_srvcs_sockets (running processes, systemd timers, services, open internal ports), network_information (interfaces, routes, ARP, iptables), users_information (.bash_history, SSH keys, password hashes, home directories), software_information (installed packages with versions), interesting_perms_files (SUID, capabilities, ACLs, NFS), interesting_files (config files with passwords, backups, database files), and api_keys_regex (credential patterns in files). Supports flags: -a (all checks including 1min process monitor + su bruteforce), -s (stealth/fast), -P <password> (sudo -l with password + su bruteforce), -o <checks> (select specific categories)."
    when_to_use: "When the built-in enumerate/check_* methods don't find a privilege escalation path. The built-in checks only cover SUID, sudo, capabilities, cron, and writable files. Linpeas additionally checks: container escape vectors (Docker socket, cgroup breakout), cloud metadata endpoints, running processes as root with writable binaries, systemd timers (not just cron), internal listening services, user home directories (.bash_history, SSH keys, .git-credentials), config files containing passwords (wp-config.php, .env, database configs), and regex scanning for API keys/tokens/credentials. Upload to target using ssh or shell-session, decode, and run. Use -o to select specific categories if full output is too large."
    params: {}
    returns:
      script:
        type: string
        description: "Script filename ('linpeas.sh')"
      size_bytes:
        type: integer
        description: "Script file size in bytes (~1MB)"
      base64:
        type: string
        description: "Base64-encoded linpeas.sh content. Decode on target with: echo '<base64>' | base64 -d > linpeas.sh && chmod +x linpeas.sh"

  get_lse:
    description: "Retrieve the bundled linux-smart-enumeration (LSE v4.14nw) script as base64 for upload to target. LSE is a lighter alternative to linpeas (~49KB vs ~1MB) with 12 test sections: usr (user tests), sud (sudo), fst (filesystem), sys (system), sec (security measures — SELinux, AppArmor, grsecurity), ret (recurrent tasks — cron AND systemd timers), net (network), srv (services), pro (processes with runtime monitoring), sof (software versions), ctn (container/Docker/lxc), cve (CVE-specific tests). Supports verbosity levels: -l 0 (critical only, default), -l 1 (interesting), -l 2 (everything). Can select specific sections with -s (e.g., '-s sud,fst,cve')."
    when_to_use: "When you need a lighter-weight alternative to linpeas for on-target enumeration. LSE is ~49KB vs linpeas ~1MB, produces less output, and is faster. Advantages over linpeas: verbosity levels (-l 0/1/2) let you filter noise, section selection (-s) for targeted checks, built-in CVE tests, security measures detection (SELinux/AppArmor). Use this when: target has limited disk space, bandwidth is constrained (e.g., through a tunnel), you want only critical findings (-l 0), or you need to check specific areas (-s sud,cve). Upload using ssh or shell-session, decode, and run on target."
    params: {}
    returns:
      script:
        type: string
        description: "Script filename ('lse.sh')"
      size_bytes:
        type: integer
        description: "Script file size in bytes (~49KB)"
      base64:
        type: string
        description: "Base64-encoded lse.sh content. Decode on target with: echo '<base64>' | base64 -d > lse.sh && chmod +x lse.sh"
