name: cve-lookup
version: "1.0"
description: "CVE vulnerability research tool using the NVD (National Vulnerability Database) API v2.0. Provides detailed CVE lookups with CVSS v3.1/v3.0/v2 scoring, affected product versions (CPE matching), CWE weakness classification, and reference links. Includes keyword-based CVE search with built-in CPE mapping for 22 common products (Apache, Nginx, OpenSSH, MySQL, PostgreSQL, WordPress, etc.), version filtering, severity filtering, and year filtering. Also finds exploit references (ExploitDB, GitHub PoCs, PacketStorm, Metasploit) from NVD reference links. Supports optional NVD_API_KEY environment variable for higher rate limits (50 req/30s vs 5 req/30s)."
image: "ghcr.io/silicon-works/mcp-tools-cve-lookup:latest"
image_size_mb: 100
timeout_seconds: 60

capabilities:
  - cve_lookup
  - vulnerability_search
  - exploit_research
  - cvss_scoring

phases:
  - enumeration
  - exploitation

requirements:
  network: true
  privileged: false

resources:
  memory_mb: 128
  cpu: 0.25

# Routing hints for tool selection
routing:
  use_for:
    - "look up CVE details including CVSS score and affected versions"
    - "search for CVEs affecting a specific product and version"
    - "find public exploits and PoCs for a CVE"
    - "check CVSS severity score for a vulnerability"
    - "find recent critical CVEs from the last week"
    - "research vulnerabilities for identified services"
    - "determine affected version range for a CVE"
    - "get CWE weakness classification for a vulnerability"
  never_use_for:
    - "active vulnerability scanning (use nuclei or nmap vuln)"
    - "exploit execution (use exploit-runner or metasploit)"
    - "port scanning (use nmap)"
    - "finding exploit code (use searchsploit for actual code)"
  triggers:
    - "CVE"
    - "vulnerability lookup"
    - "NVD"
    - "exploit search"
    - "CVSS"
    - "vulnerability research"
    - "what is CVE"
    - "affected versions"
  prefer_over:
    - searchsploit  # For CVE details, CVSS scores, and version ranges (searchsploit is better for exploit code)

environment:
  NVD_API_KEY:
    description: "Optional NVD API key for higher rate limits"
    required: false

methods:
  lookup:
    description: "Look up a specific CVE by ID from the NVD API v2.0. Returns comprehensive vulnerability details: English description, CVSS base score with severity rating (prefers v3.1 → falls back to v3.0 → v2.0), CVSS vector string for attack complexity analysis, affected products with vendor/product/version ranges parsed from CPE matching data, CWE weakness classification IDs, publication and last-modified dates, and up to 10 reference links (advisories, patches, PoCs). Automatically normalizes the CVE ID — accepts 'CVE-2024-32019', 'cve-2024-32019', or '2024-32019'."
    when_to_use: "When you have a CVE ID and need to understand the vulnerability before exploitation. Common sources of CVE IDs: (1) nmap scripts (vuln, http-vuln-*) output CVE references, (2) nuclei scanner results include CVE IDs, (3) searchsploit results reference CVEs, (4) web application error pages or headers reveal version-specific CVEs. Use lookup to get: CVSS score for severity triage (CRITICAL ≥9.0 first), affected version ranges to confirm the target is vulnerable, CWE classification to understand the vulnerability class (e.g., CWE-79 = XSS, CWE-89 = SQLi), and reference links that may point to patches, advisories, or PoC code."
    params:
      cve_id:
        type: string
        required: true
        description: "CVE ID in any format — 'CVE-2024-32019', 'cve-2024-32019', or bare '2024-32019'. The CVE- prefix and uppercase are applied automatically. Must be a valid CVE ID that exists in NVD."
    returns:
      cve_id:
        type: string
        description: "Normalized CVE identifier (uppercase with CVE- prefix)"
      description:
        type: string
        description: "English vulnerability description from NVD"
      cvss_score:
        type: number
        description: "CVSS base score (0.0-10.0). Null if no CVSS data available (rare for recent CVEs)"
      cvss_severity:
        type: string
        description: "Severity level: LOW (0.1-3.9), MEDIUM (4.0-6.9), HIGH (7.0-8.9), CRITICAL (9.0-10.0)"
      cvss_vector:
        type: string
        description: "CVSS vector string (e.g., 'CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H') — describes attack vector, complexity, privileges, and impact"
      affected_products:
        type: array
        description: "Up to 10 affected products parsed from CPE data, each with vendor, product, version_start (inclusive), and version_end (exclusive or inclusive). Use to confirm target version falls within the vulnerable range."
      weaknesses:
        type: array
        description: "CWE IDs (e.g., 'CWE-79', 'CWE-89') classifying the vulnerability type"
      references:
        type: array
        description: "Up to 10 reference links with URL, source, and tags (Patch, Exploit, Vendor Advisory, Third Party Advisory, etc.)"

  search:
    description: "Search NVD for CVEs matching a keyword with optional version, severity, and year filters. Uses NVD's keywordSearch API which matches against CVE descriptions and product names. Returns a summary list of matching CVEs — each with CVE ID, CVSS score, severity, truncated description (300 chars), and publication date. Client-side version filtering compares the specified version against CPE version ranges (simple string comparison, not semver). Results capped at 100 from the API, further limited by the limit parameter. NVD rate limits apply: 5 requests per 30 seconds without API key, 50 with API key."
    when_to_use: "The standard workflow after nmap service_scan identifies software versions — search by product name to find known CVEs. Examples: after nmap finds 'Apache httpd 2.4.49', search keyword='apache' version='2.4.49'. After finding 'OpenSSH 7.2p2', search keyword='openssh' version='7.2'. Search tips: (1) Use simple product names: 'apache' not 'Apache httpd 2.4.49 (Ubuntu)'. (2) Combine with severity='CRITICAL' or severity='HIGH' to prioritize exploitable vulns. (3) Use year filter to focus on recent CVEs (older CVEs are more likely patched). (4) Version filtering is approximate — review results manually to confirm applicability. (5) For a specific CVE found in results, use lookup for full details. (6) Follow up with exploits method to check for public exploit code."
    params:
      keyword:
        type: string
        required: true
        description: "Product name or keyword to search. Use simple product names for best results: 'apache', 'nginx', 'openssh', 'wordpress', 'mysql', 'postgresql', 'tomcat', 'jenkins', 'redis', 'elasticsearch', 'drupal', 'joomla', 'php'. NVD matches against CVE descriptions, so general terms like 'buffer overflow' or 'remote code execution' also work but return very broad results."
      version:
        type: string
        description: "Product version for client-side filtering against CPE version ranges. Simple string comparison (not semver) — '2.4.49' is compared against versionStartIncluding/versionEndExcluding ranges. Omit the version to see all CVEs for the product, then filter manually."
      severity:
        type: enum
        values: [LOW, MEDIUM, HIGH, CRITICAL]
        description: "Filter by CVSS v3 severity. During pentesting, start with CRITICAL to find the most exploitable vulns, then expand to HIGH if nothing actionable. MEDIUM and LOW are rarely worth pursuing unless no higher-severity options exist."
      limit:
        type: integer
        default: 20
        description: "Maximum results to return (1-100). NVD API caps at 100 per request. Default 20 is usually sufficient — increase if searching broad terms like 'apache' where relevant results may be buried."
      year:
        type: integer
        description: "Filter by publication year (e.g., 2024). Useful to focus on recent CVEs which are more likely to lack patches or have public exploits. Also useful for CTFs where challenge authors use CVEs from specific years."
    returns:
      cves:
        type: array
        description: "Matching CVEs, each with: cve_id, cvss_score, cvss_severity, description (truncated to 300 chars), published date"
      total_results:
        type: integer
        description: "Total matching CVEs in NVD (may be much larger than returned results — increase limit or add filters to narrow)"

  recent:
    description: "Get CVEs published in the last 7 days from NVD. Returns the same summary format as search — CVE ID, CVSS score, severity, truncated description, and publication date. Queries NVD with pubStartDate/pubEndDate for the last 7-day window. Useful for zero-day awareness and checking if recently disclosed vulnerabilities affect identified targets. NVD rate limits apply."
    when_to_use: "Two main scenarios: (1) At the start of an engagement, check for freshly disclosed CVEs in the target's technology stack — recent CVEs are more likely unpatched. Filter by severity='CRITICAL' for the most impactful. (2) During long-running engagements, periodically check for new disclosures that may open new attack paths. Note: NVD publication can lag 24-72 hours behind the original disclosure, so very new vulnerabilities may not appear yet."
    params:
      severity:
        type: enum
        values: [LOW, MEDIUM, HIGH, CRITICAL]
        description: "Filter by CVSS v3 severity. Use CRITICAL to find the most impactful recent disclosures. Without this filter, results include all severities including LOW which are rarely actionable."
      limit:
        type: integer
        default: 20
        description: "Maximum results (1-100). 20 is usually sufficient for a weekly snapshot. Increase to 50-100 if filtering by CRITICAL severity, as there are typically few critical CVEs per week."
    returns:
      cves:
        type: array
        description: "Recent CVEs from last 7 days, each with: cve_id, cvss_score, cvss_severity, description (truncated to 300 chars), published date"
      total_results:
        type: integer
        description: "Total recent CVEs in the 7-day window (before severity filtering)"

  exploits:
    description: "Find known public exploits for a CVE by scanning its NVD reference links. Checks references for exploit-related indicators: ExploitDB URLs, GitHub repositories containing 'exploit', 'poc', or 'CVE' in the path, PacketStorm URLs, 0day.today URLs, and Rapid7/Metasploit references. Also checks NVD's reference tags for the 'Exploit' tag. Returns matching exploit URLs grouped by source, plus ready-to-use follow-up commands: a searchsploit query (CVE number without 'CVE-' prefix) and a Metasploit 'search cve:' command. Note: this only finds exploits linked from NVD references — it does NOT search ExploitDB or GitHub directly. For comprehensive exploit search, follow up with the searchsploit tool."
    when_to_use: "After search or lookup identifies a CVE that affects the target, use this to determine if public exploit code exists before attempting manual exploitation. The workflow: (1) search for CVEs → (2) exploits to check for PoCs → (3) if ExploitDB found, use searchsploit get_exploit to retrieve the code → (4) if Metasploit found, use metasploit tool → (5) if GitHub PoC found, the URL is returned for manual review. This is a quick triage step — if no exploit references are found in NVD, the CVE may still have exploits that aren't linked from NVD. Always follow up with searchsploit for a more thorough search."
    params:
      cve_id:
        type: string
        required: true
        description: "CVE ID to search exploits for. Accepts any format: 'CVE-2021-44228', 'cve-2021-44228', or '2021-44228'. Normalized automatically."
    returns:
      exploit_references:
        type: array
        description: "URLs to exploit code or PoCs, each with url, source, and tags. Empty array if no exploit references found in NVD."
      exploit_sources:
        type: array
        description: "Deduplicated list of sources with exploits: 'ExploitDB', 'GitHub', 'Metasploit', 'PacketStorm'. Empty if none found."
      searchsploit_query:
        type: string
        description: "Ready-to-use query for the searchsploit tool's --cve flag (e.g., '2021-44228' for CVE-2021-44228). Use with searchsploit search."
      metasploit_search:
        type: string
        description: "Ready-to-use Metasploit search command (e.g., 'search cve:CVE-2021-44228'). Use with metasploit tool."
