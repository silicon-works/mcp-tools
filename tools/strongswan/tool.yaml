name: strongswan
version: "1.0.0"
description: "IPsec VPN client for establishing VPN connections with cracked PSK, EAP credentials, or certificates"
image: "ghcr.io/silicon-works/mcp-tools-strongswan:latest"
image_size_mb: 200

# Service container - persists for session, other tools share its network
service: true
service_name: "vpn"

capabilities:
  - ipsec_vpn
  - vpn_client
  - ikev1_client
  - ikev2_client
  - psk_authentication
  - eap_authentication
  - certificate_authentication

routing:
  use_for:
    - "Establish IPsec VPN connection"
    - "Connect to VPN with cracked PSK"
    - "IKEv1 aggressive mode VPN"
    - "IKEv2 VPN connection"
    - "VPN tunnel establishment"
  never_use_for:
    - "IKE enumeration (use ike-scan)"
    - "PSK cracking (use ike-scan)"
    - "SSL VPN"
    - "OpenVPN"
  triggers:
    - "vpn connect"
    - "establish vpn"
    - "ipsec connect"
    - "use cracked psk"
  prefer_over: []

phases:
  - exploitation
  - post-exploitation

requirements:
  network: true
  privileged: true  # Required for tunnel interface creation

resources:
  memory_mb: 128
  cpu: 0.25

methods:
  connect:
    description: "Establish an IPsec VPN connection"
    when_to_use: "After cracking IKE PSK or obtaining VPN credentials, to establish a tunnel to the target network"
    next_step: "Once connected, enumerate the internal network or access services via the VPN tunnel"
    params:
      target:
        type: string
        required: true
        description: "VPN gateway IP address or hostname"
      psk:
        type: string
        description: "Pre-shared key for authentication (from cracked hash or found credentials)"
      group_name:
        type: string
        description: "IKE ID / group name (typically the group name used in aggressive mode)"
      username:
        type: string
        description: "Username for EAP authentication"
      password:
        type: string
        description: "Password for EAP authentication"
      cert:
        type: string
        description: "Path to certificate file (/session/certs/client.crt)"
      key:
        type: string
        description: "Path to private key file (/session/certs/client.key)"
      ike_version:
        type: integer
        default: 1
        description: "IKE version: 1 or 2"
      mode:
        type: string
        default: "aggressive"
        description: "IKEv1 mode: 'aggressive' or 'main'"
      transforms:
        type: string
        description: "Custom IKE/ESP transforms (e.g., 'aes256-sha1-modp1024')"
      connection_name:
        type: string
        description: "Custom connection name (auto-generated if not provided)"
      timeout:
        type: integer
        default: 120
        description: "Connection timeout in seconds (default: 120)"
    returns:
      connection_name:
        type: string
        description: "Name of the established connection"
      target:
        type: string
        description: "VPN gateway address"
      virtual_ip:
        type: string
        description: "IP address assigned by VPN (if any)"
      status:
        type: string
        description: "Connection status"

  disconnect:
    description: "Disconnect a VPN connection"
    when_to_use: "To close a VPN tunnel when no longer needed"
    params:
      connection:
        type: string
        default: "all"
        description: "Connection name to disconnect, or 'all' for all connections"
    returns:
      disconnected:
        type: string
        description: "Name(s) of disconnected connection(s)"

  status:
    description: "Get status of active VPN connections"
    when_to_use: "To check if VPN is connected and get assigned IP/routes"
    params: {}
    returns:
      connections:
        type: array
        description: "List of active connections with details"
      routes:
        type: string
        description: "Current routing table"
