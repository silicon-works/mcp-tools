name: office-exploit
version: "1.0"
description: "Create malicious Microsoft Office documents (XLSX, DOCX, PPTX) with embedded XSS, XXE, SSRF, formula injection, and template injection payloads for authorized security testing. 6 methods: create_xlsx (XSS via sheet names, XXE in 6 XML targets, formula injection, external links for SSRF), create_docx (XXE, external image SSRF, Follina-style template injection), create_pptx (XXE, external media SSRF, hover/click action links), modify_office_xml (low-level XML editing via xpath), extract_office_xml (inspect XML internals), list_payloads (show available templates). All outputs include base64-encoded file content for immediate delivery. No macros (use metasploit for VBA macro payloads)."
image: "ghcr.io/silicon-works/mcp-tools-office-exploit:latest"
image_size_mb: 80

capabilities:
  - malicious_document_generation
  - xxe_injection
  - xss_injection
  - ssrf_exploitation
  - formula_injection
  - template_injection

see_also:
  - curl          # For uploading generated documents
  - metasploit    # For macro-based payloads (future)

routing:
  use_for:
    - "create malicious Excel XLSX with XSS payload in sheet names for PHPSpreadsheet CVE-2025-22131"
    - "create malicious Word DOCX with XXE payload to read server files or trigger SSRF"
    - "create malicious PowerPoint PPTX with hover or click action link for code execution"
    - "XXE injection via crafted Office document uploaded to web application"
    - "SSRF via external image or link reference in Office document"
    - "formula injection in Excel spreadsheet for CSV injection or data exfiltration"
    - "Follina-style template injection in DOCX via ms-msdt protocol handler"
    - "extract and inspect XML internals of Office documents for custom payload crafting"
  never_use_for:
    - "legitimate document creation"
    - "document conversion"
    - "reading Office files"
    - "macro generation"
  triggers:
    - "malicious xlsx"
    - "malicious docx"
    - "malicious pptx"
    - "xxe payload"
    - "xss spreadsheet"
    - "office exploit"
    - "formula injection"
  prefer_over: []

warnings:
  - "Generated documents are for authorized security testing ONLY"
  - "Macro payloads (XLSM/DOCM) not supported in v1 - use metasploit instead"
  - "Output files must be within /session/ directory"

phases:
  - exploitation

requirements:
  network: false
  privileged: false

resources:
  memory_mb: 128
  cpu: 0.25

methods:
  create_xlsx:
    description: "Create a malicious Excel file with XSS, XXE, formula injection, or external link payloads"
    when_to_use: "When you need to exploit web applications that process XLSX files (PHPSpreadsheet, Apache POI, etc.)"
    params:
      output_path:
        type: string
        required: true
        description: "Path to save the file (must be within /session/)"
      sheets:
        type: array
        required: true
        description: "Array of sheet definitions: [{name: string, data?: string[][]}]. Sheet names are NOT sanitized."
      payload_type:
        type: enum
        values: [xss_sheetname, xxe, formula, external_link]
        description: "Type of payload to inject"
      xxe_style:
        type: enum
        values: [oob_http, oob_ftp, file_read, ssrf]
        default: oob_http
        description: "XXE injection style"
      xxe_target_xml:
        type: enum
        values: [sharedStrings, workbook, sheet1, styles, contentTypes, multi]
        default: sharedStrings
        description: "XML file to inject XXE into"
      xxe_callback_url:
        type: string
        description: "Callback URL for OOB XXE"
      xxe_file_to_read:
        type: string
        description: "File path for file_read XXE"
      formula:
        type: string
        description: "Formula to inject in cell A1 (shortcut)"
      external_link_type:
        type: enum
        values: [workbook_ref, web_query]
        default: workbook_ref
        description: "Type of external link for SSRF"
      external_url:
        type: string
        description: "External URL for SSRF payloads"
    returns:
      path:
        type: string
        description: "Path to generated file"
      size_bytes:
        type: integer
        description: "File size in bytes"
      sha256:
        type: string
        description: "SHA256 hash of file"
      payload_type:
        type: string
        description: "Type of payload injected"
      injection_locations:
        type: array
        description: "XML files modified"
      content_base64:
        type: string
        description: "Base64-encoded file content for immediate use"

  create_docx:
    description: "Create a malicious Word file with XXE, external image, or template injection payloads"
    when_to_use: "When you need to exploit applications that process DOCX files or need SSRF via document"
    params:
      output_path:
        type: string
        required: true
        description: "Path to save the file (must be within /session/)"
      content:
        type: string
        description: "Document text content"
      payload_type:
        type: enum
        values: [xxe, external_image, template_injection]
        description: "Type of payload to inject"
      xxe_style:
        type: enum
        values: [oob_http, oob_ftp, file_read, ssrf]
        default: oob_http
        description: "XXE injection style"
      xxe_target_xml:
        type: enum
        values: [document, settings, styles, fontTable, webSettings, multi]
        default: document
        description: "XML file to inject XXE into"
      xxe_callback_url:
        type: string
        description: "Callback URL for OOB XXE"
      xxe_file_to_read:
        type: string
        description: "File path for file_read XXE"
      external_url:
        type: string
        description: "External URL for image/template SSRF"
      template_type:
        type: enum
        values: [remote, msdt]
        default: remote
        description: "Template injection type (msdt = Follina-style)"
      template_url:
        type: string
        description: "URL for remote template"
    returns:
      path:
        type: string
        description: "Path to generated file"
      size_bytes:
        type: integer
        description: "File size in bytes"
      sha256:
        type: string
        description: "SHA256 hash of file"
      payload_type:
        type: string
        description: "Type of payload injected"
      injection_locations:
        type: array
        description: "XML files modified"
      content_base64:
        type: string
        description: "Base64-encoded file content"

  create_pptx:
    description: "Create a malicious PowerPoint file with XXE, external media, or action link payloads"
    when_to_use: "When you need to exploit applications that process PPTX files or need hover/click-triggered attacks"
    params:
      output_path:
        type: string
        required: true
        description: "Path to save the file (must be within /session/)"
      payload_type:
        type: enum
        values: [xxe, external_media, action_link]
        description: "Type of payload to inject"
      xxe_style:
        type: enum
        values: [oob_http, oob_ftp, file_read, ssrf]
        default: oob_http
        description: "XXE injection style"
      xxe_target_xml:
        type: enum
        values: [presentation, slide1, slideLayout, slideMaster, multi]
        default: presentation
        description: "XML file to inject XXE into"
      xxe_callback_url:
        type: string
        description: "Callback URL for OOB XXE"
      xxe_file_to_read:
        type: string
        description: "File path for file_read XXE"
      external_url:
        type: string
        description: "External URL for media SSRF"
      trigger:
        type: enum
        values: [hover, click]
        default: hover
        description: "Action link trigger"
      action:
        type: enum
        values: [hyperlink, program]
        default: hyperlink
        description: "Action type"
      action_target:
        type: string
        description: "Target URL or program path"
    returns:
      path:
        type: string
        description: "Path to generated file"
      size_bytes:
        type: integer
        description: "File size in bytes"
      sha256:
        type: string
        description: "SHA256 hash of file"
      payload_type:
        type: string
        description: "Type of payload injected"
      injection_locations:
        type: array
        description: "XML files modified"
      content_base64:
        type: string
        description: "Base64-encoded file content"

  modify_office_xml:
    description: "Low-level XML manipulation for custom payloads not covered by create_* methods"
    when_to_use: "When pre-built payloads don't fit your needs and you need fine-grained control over Office XML"
    params:
      input_path:
        type: string
        required: true
        description: "Path to existing Office file"
      output_path:
        type: string
        required: true
        description: "Path to save modified file"
      xml_file:
        type: string
        required: true
        description: "XML file within archive (e.g., 'xl/workbook.xml')"
      modifications:
        type: array
        required: true
        description: "Array of modifications: [{xpath, action, content}]"
    returns:
      path:
        type: string
        description: "Path to modified file"
      size_bytes:
        type: integer
        description: "File size in bytes"
      sha256:
        type: string
        description: "SHA256 hash of file"
      injection_locations:
        type: array
        description: "XML files modified"
      content_base64:
        type: string
        description: "Base64-encoded file content"

  extract_office_xml:
    description: "Extract and inspect XML files from Office documents"
    when_to_use: "To analyze existing Office files before crafting custom payloads"
    params:
      input_path:
        type: string
        required: true
        description: "Path to Office file"
      xml_file:
        type: string
        description: "Specific XML file to extract (omit to list all files)"
    returns:
      file:
        type: string
        description: "Extracted file path (when xml_file specified)"
      content:
        type: string
        description: "XML content (when xml_file specified)"
      files:
        type: array
        description: "List of files in archive (when xml_file omitted)"

  list_payloads:
    description: "List available payload templates and examples"
    when_to_use: "To discover what payload types are available before generating documents"
    params:
      file_type:
        type: enum
        values: [xlsx, docx, pptx]
        description: "Filter by file type"
      category:
        type: enum
        values: [xss, xxe, ssrf, formula]
        description: "Filter by attack category"
    returns:
      payloads:
        type: object
        description: "Available payloads organized by file type and category"
