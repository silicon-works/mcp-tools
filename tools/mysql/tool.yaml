name: mysql
version: "8.0"
description: "MySQL/MariaDB client (mysql CLI 8.0) for direct database access, enumeration, and data extraction. 5 methods: query (execute arbitrary SQL), list_databases (SHOW DATABASES), list_tables (SHOW TABLES in database), dump_table (SELECT with column filtering and row limit), find_credentials (auto-search for user/password columns across tables). Uses the mysql CLI with JSON output for structured results. Connects per-query (no persistent sessions)."
image: "ghcr.io/silicon-works/mcp-tools-mysql:latest"
image_size_mb: 300

capabilities:
  - database_enumeration
  - sql_query_execution
  - credential_extraction
  - data_exfiltration

phases:
  - enumeration
  - post-exploitation

requirements:
  network: true
  privileged: false

resources:
  memory_mb: 256
  cpu: 0.5

# Routing hints for tool selection
routing:
  use_for:
    - "connect to MySQL or MariaDB and run SQL queries"
    - "enumerate databases and tables on MySQL server"
    - "extract credentials from MySQL user tables"
    - "dump table contents from MySQL database"
    - "find password hashes in MySQL database"
    - "read files via MySQL LOAD_FILE function"
  never_use_for:
    - "SQL injection testing (use sqlmap)"
    - "port scanning"
    - "MongoDB or SQLite access"
  triggers:
    - "MySQL"
    - "MariaDB"
    - "database query"
    - "SQL query"
    - "database enumeration"
    - "port 3306"
    - "dump database"

methods:
  query:
    description: "Execute an arbitrary SQL query on a MySQL/MariaDB database. Returns results as an array of row objects with column names as keys. Supports SELECT, SHOW, DESCRIBE, and data modification queries. Output is JSON-parsed for structured results."
    when_to_use: "For custom SQL queries beyond what the helper methods provide. Common pentest queries: (1) 'SELECT user, authentication_string FROM mysql.user' — dump MySQL user hashes, (2) 'SELECT LOAD_FILE(\"/etc/passwd\")' — read files via MySQL (requires FILE privilege), (3) 'SELECT @@version' — get MySQL version, (4) 'SHOW GRANTS FOR CURRENT_USER()' — check privileges, (5) 'SELECT * FROM information_schema.tables' — full schema enumeration. Use list_databases/list_tables/dump_table for standard enumeration instead."
    params:
      host:
        type: string
        required: true
        description: "MySQL server hostname or IP. Use '127.0.0.1' with tunnel forward for localhost-only databases."
      username:
        type: string
        required: true
        description: "MySQL username (e.g., 'root', 'admin', discovered user)."
      password:
        type: string
        description: "MySQL password."
      database:
        type: string
        description: "Database to USE before running the query. Omit for cross-database queries."
      query:
        type: string
        required: true
        description: "SQL query to execute. Semicolons handled automatically."
      port:
        type: integer
        default: 3306
        description: "MySQL port."
      timeout:
        type: integer
        default: 30
        description: "Query timeout in seconds."
    returns:
      rows:
        type: array
        description: "Query results as array of {column: value} objects."
      row_count:
        type: integer
        description: "Number of rows returned."

  list_databases:
    description: "List all databases on the MySQL server (SHOW DATABASES). Filters out system databases or includes them based on context."
    when_to_use: "First step after gaining MySQL credentials. Shows all databases — look for application databases (wordpress, drupal, custom_app) vs system databases (mysql, information_schema, performance_schema, sys). Application databases often contain user credentials."
    params:
      host:
        type: string
        required: true
        description: "MySQL server hostname or IP."
      username:
        type: string
        required: true
        description: "MySQL username."
      password:
        type: string
        description: "MySQL password."
      port:
        type: integer
        default: 3306
        description: "MySQL port."
    returns:
      databases:
        type: array
        description: "List of database names."

  list_tables:
    description: "List all tables in a specific database (SHOW TABLES)."
    when_to_use: "After identifying an interesting database via list_databases. Look for tables named: users, accounts, credentials, admins, members, auth, sessions — these likely contain credentials. Also look for: posts, comments, messages — may contain sensitive data."
    params:
      host:
        type: string
        required: true
        description: "MySQL server hostname or IP."
      username:
        type: string
        required: true
        description: "MySQL username."
      password:
        type: string
        description: "MySQL password."
      database:
        type: string
        required: true
        description: "Database name to list tables from."
      port:
        type: integer
        default: 3306
        description: "MySQL port."
    returns:
      tables:
        type: array
        description: "List of table names in the database."

  dump_table:
    description: "Dump contents of a specific table with optional column filtering and row limit (default 100 rows). Builds a SELECT query from the parameters."
    when_to_use: "To extract data from a table identified via list_tables or find_credentials. Use columns param to select only relevant columns (e.g., columns=['username','password'] to avoid dumping large text fields). Increase limit for full extraction. For large tables, use query method with specific WHERE clauses instead."
    params:
      host:
        type: string
        required: true
        description: "MySQL server hostname or IP."
      username:
        type: string
        required: true
        description: "MySQL username."
      password:
        type: string
        description: "MySQL password."
      database:
        type: string
        required: true
        description: "Database name."
      table:
        type: string
        required: true
        description: "Table name to dump."
      columns:
        type: array
        description: "Specific columns to select (e.g., ['username', 'password', 'email']). Omit for SELECT *."
      limit:
        type: integer
        default: 100
        description: "Maximum number of rows to return."
      port:
        type: integer
        default: 3306
        description: "MySQL port."
    returns:
      data:
        type: array
        description: "Table rows as array of {column: value} objects."
      row_count:
        type: integer
        description: "Number of rows returned."

  find_credentials:
    description: "Automatically search for tables containing credential-like data across one or all databases. Looks for tables with columns named: user, username, login, email, password, pass, pwd, hash, secret, token. Dumps matching rows."
    when_to_use: "Quick credential discovery — faster than manually checking each table. Run this first after list_databases to find low-hanging fruit. Found hashes can be cracked with john or looked up via hash-lookup. Specify database to narrow the search, or omit to scan all accessible databases."
    params:
      host:
        type: string
        required: true
        description: "MySQL server hostname or IP."
      username:
        type: string
        required: true
        description: "MySQL username."
      password:
        type: string
        description: "MySQL password."
      database:
        type: string
        description: "Database to search. Omit to search all accessible databases."
      port:
        type: integer
        default: 3306
        description: "MySQL port."
    returns:
      tables:
        type: array
        description: "Tables containing credential-like columns."
      credentials:
        type: array
        description: "Extracted rows with username/password/hash data."
